<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Last Time Tracker</title>
</head>
<body>
<h1>事项列表</h1>

<ul id="list"></ul>

<input id="newItem" placeholder="新事项名称">
<button onclick="addItem()">添加</button>

<script>
async function load() {
  const res = await fetch('/api/items');
  const items = await res.json();
  const ul = document.getElementById('list');
  ul.innerHTML = '';

  items.forEach(i => {
    const li = document.createElement('li');
    const t = i.last_time ? new Date(i.last_time * 1000).toLocaleString() : '从未';
    li.innerHTML = `
      <b>${i.name}</b>：${t}
      <button onclick="refresh(${i.id})">刷新</button>
      <button onclick="history(${i.id})">历史</button>
    `;
    ul.appendChild(li);
  });
}

async function refresh(id) {
  if (!confirm('确定刷新为当前时间？')) return;
  await fetch(`/api/items/${id}/refresh`, {method: 'POST'});
  load();
}

async function history(id) {
  const res = await fetch(`/api/items/${id}/history`);
  const h = await res.json();
  alert(
    h.map(x => new Date(x * 1000).toLocaleString())
     .join('\n')
  );
}

async function addItem() {
  const name = document.getElementById('newItem').value;
  await fetch('/api/items', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({name})
  });
  document.getElementById('newItem').value = '';
  load();
}

load();
</script>
</body>
</html>
